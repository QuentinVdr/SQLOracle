-- épreuve 2.1
-- On sait que le code des vehicules electrique est "EL" grace à SELECT * FROM EVAL.ENERGIES;
SELECT
  M.MARQUE,
  M.MODELE
FROM
  EVAL.MODELES M
WHERE
  M.ENERGIE = 'EL'
GROUP BY
  M.MARQUE,
  M.MODELE;

-- épreuve 2.2
-- On sait que le code des vehicules electrique et hibride sont "EL", "EE", "EH", "GL", "GH" grace à SELECT * FROM EVAL.ENERGIES;
SELECT
  P.NOM,
  P.PRENOM,
  V.IMMATRICULATION,
  E.LIBELLE,
  SUBSTR(A.CODE_POSTAL, 1, 2) AS DEPARTEMENT
FROM
  EVAL.PERSONNES P
  INNER JOIN EVAL.VEHICULES V
  ON P.ID = V.PROPRIETAIRE
  INNER JOIN EVAL.MODELES M
  ON V.MODELE = M.MODELE
  INNER JOIN EVAL.ENERGIES E
  ON M.ENERGIE = E.CODE
  INNER JOIN EVAL.ADRESSES A
  ON P.ADRESSE = A.ID
WHERE
  M.ENERGIE IN ('EL', 'EE', 'EH', 'GL', 'GH')
  AND SUBSTR(A.CODE_POSTAL, 1, 2) IN ('44', '49', '53', '72', '85');

-- épreuve 2.3
SELECT
  MAX(C.MONTANT)    AS MONTANT_MAX,
  V.IMMATRICULATION
FROM
  EVAL.CONTRAVENTIONS C
  INNER JOIN EVAL.VEHICULES V
  ON C.VEHICULE = V.IMMATRICULATION
GROUP BY
  V.IMMATRICULATION;

-- épreuve 2.4
SELECT
  V.IMMATRICULATION,
  COUNT(C.MONTANT)  AS NB_CONTRAVENTIONS
FROM
  EVAL.VEHICULES      V
  LEFT JOIN EVAL.CONTRAVENTIONS C
  ON V.IMMATRICULATION = C.VEHICULE
GROUP BY
  V.IMMATRICULATION
ORDER BY
  NB_CONTRAVENTIONS DESC;

-- épreuve 2.5
SELECT
  P.NOM,
  P.PRENOM
FROM
  EVAL.PERSONNES      P
  INNER JOIN EVAL.VEHICULES V
  ON P.ID = V.PROPRIETAIRE
  INNER JOIN EVAL.CONTRAVENTIONS C
  ON V.IMMATRICULATION = C.VEHICULE
WHERE
  C.MONTANT = 33
  OR C.MONTANT = 75
  OR C.MONTANT = 180
  OR C.MONTANT = 375
GROUP BY
  P.NOM,
  P.PRENOM;
